/*Fluid Properties Formulas*/

/*Petrosky*/






/*------------------------------------------------------------------------------------------------------------------
------------------------------------------------------OIL-----------------------------------------------------------
---------------------------------------------------PROPERTIES-------------------------------------------------------
------------------------------------------------------------------------------------------------------------------*/



/*-------------------------------------------------------------------------------------------------------------------
----------------------------------------------Calculate Solution GOR-------------------------------------------------
-------------------------------------------------------------------------------------------------------------------*/

if (APIOil > 30){
      A = 1.0937;
      B = 27.64;
      C = 11.172;
}
else{
     A = 1.187;
     B = 56.06;
     C = 10.393;
}
gammaG100 = (1. + 0.5912 * APIOil * Tsep * 0.0001 * log10(Psep / 114.7) / log10(10))*gammaG;
Rs = (gammaG100 * pow(P,A) / B);
Rs = Rs * pow(10,C*APIOil/(T+460));
Rs = 1050;
Pb = B*Rp;
Pb = Pb / gammaG100 / pow(10,(C * APIOil / (T+460)));
Pb = pow(Pb,(1/A));


if (Rs < 0){
Rs = 0;
}
if (Rs>Rp){
Rs = Rp;
}






/*-------------------------------------------------------------------------------------------------------------------
----------------------------------------------Bubble Point Pressure--------------------------------------------------
-------------------------------------------------------------------------------------------------------------------*/
if (APIOil <= 30){
	C1 = 0.0362;
	C2 = 1.0937;
	C3 = 25.7240;
}
else{
	C1 = .0178;
	C2 = 1.1870;
	C3 = 23.9310;
}
/*
Pb = pow((Rp / C1 / gammaG / pow(2.71828,C3*APIOil/(T+460))),1/C2);
*/


/*-------------------------------------------------------------------------------------------------------------------
----------------------------------------------Calculate Oil Viscosity------------------------------------------------
-------------------------------------------------------------------------------------------------------------------*/
/*Beggs and Robinson*/
muOd = 31410000000 * pow(T , (-3.444)) * pow((log(APIOil) / log(10)) , (10.313 * log(T) / log(10) - 36.447));
A = 10.7150 / pow((Rs + 100) , 0.515);
B = 5.440 / pow((Rs + 150) , 0.338);
muO = A * pow(muOd , B);

if (P > Pb) {
      A = 2.6 * pow(P , 1.187) * pow(10 , (-0.039 * P * 0.001 - 5));
      muO = muO * pow((P / Pb) , A);
}


/*-------------------------------------------------------------------------------------------------------------------
----------------------------------------------Calculate Liquid Density-----------------------------------------------
-------------------------------------------------------------------------------------------------------------------*/
/*Vasquez*/
gammaO = 141.5 / (131.5 + APIOil);
D = (T - 60) * APIOil / gammaG100;
if (APIOil <= 30) {
    A = 0.1751;
    B = -1.8106;
}
else{
    A = 0.11;
    B = 0.1337;
}

if (P < Pb){
	Bo = 1 + 0.000467 * Rs + A * D * 0.0001 + B * Rs * D * 0.00000001;
    CO = (-1433 + 5 * GOR + 17.2 * T - 1180 * gammaG100 + 12.61 * APIOil) / (P * 100000);
}
else{
	Bob = 1 + 0.000467 * GOR + A * D * 0.0001 + B * GOR * D * 0.00000001;
	CO = (-1433 + 5 * Rs + 17.2 * T - 1180 * gammaG100 + 12.61 * APIOil) / (P * 100000);
    	Bo = Bob * pow(2.718,(CO * (Pb - P)));
}



/*gammaG???*/
rhoO = (gammaO * 62.4) / Bo;
rhoW = gammaW * 62.4;
rhoL = rhoO * (1-WCut) + rhoW * WCut;






/*------------------------------------------------------------------------------------------------------------------
------------------------------------------------------GAS-----------------------------------------------------------
---------------------------------------------------PROPERTIES-------------------------------------------------------
------------------------------------------------------------------------------------------------------------------*/


/*-------------------------------------------------------------------------------------------------------------------
--------------------------------------------------Calculate Bg-------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------*/
Z = 1; /*assume ideal gas for now*/
Bg = 0.0283 * Z * (T+460) / P;


/*-------------------------------------------------------------------------------------------------------------------
----------------------------------------------Calculate Gas Density------------------------------------------------
-------------------------------------------------------------------------------------------------------------------*/
rhoG = P/10.7315/(T+460)/ (28.9586*gammaG); /*lbm/ft^3*/


/*-------------------------------------------------------------------------------------------------------------------
----------------------------------------------Calculate Gas Viscosity------------------------------------------------
-------------------------------------------------------------------------------------------------------------------*/
Ma = 28.9586*gammaG;
A = (9.379 + 0.01607 * Ma) * pow(T+460,1.5);
A = A / (209.2 + 19.26*Ma+T+460);
B = 3.448 + 986.4 / (T+460) + 0.01009 * Ma;
C = 2.447 - 0.2224 * B;
muG = A * 0.0001 * exp(B*pow(rhoG*0.0160,C));

/******************************************************************************************************************
*/
cout << gammaG100 << " ------------------------gamma" << endl;
cout << Pb << " ------------------------Pb" << endl;
cout << Rs << " ------------------------Rs" << endl;
cout << muO << " ------------------------muO" << endl;
cout << rhoL << " ------------------------rhoL" << endl;
cout << Bo << " ------------------------Bo" << endl;
